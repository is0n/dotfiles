#!/usr/bin/env bash

dimensions=$(xdpyinfo | awk '/dimensions/ { print $2 }')
output="$HOME/Videos/Recordings/$(date +%Y-%m-%d-%T)-recording.mkv"
thumbnail="$HOME/.cache/recording-thumbnail.png"

function record {
  scrot "${thumbnail}"
	dunstify "Screen Recording Initiated"
	ffmpeg -video_size $dimensions -framerate 30 -f x11grab -i :0.0+0,0 -c:v libx264rgb -crf 0 -preset ultrafast $output
  rm "${thumbnail}"
}

function end_record {
  dunstify "Screen Recording Ended"
  killall ffmpeg
}

pgrep ffmpeg && end_record || record
